<!DOCTYPE html>
<html>

<head>
    <title>Bounce Battle</title>
    <!-- Add the Bootstrap CSS file -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="bounce-battle.css" />
</head>

<body>
    <div class="container">
        <canvas id="canvas" width="600" height="400"></canvas>
    </div>
    <div class="button">
        <button id="start-btn" class="btn">Start</button>
        <button id="pause-btn" class="btn">Pause</button>
        <button id="restart-btn" class="btn">Restart</button>
    </div>
    <p class="control">Control: Player Left(W and S) | Player Right(↑ and ↓)</p>
    <!-- Add a modal element with an ID -->
    <div class="modal" tabindex="-1" role="dialog" id="message-modal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <h5 id="message"></h5>
                </div>
                <div class="modal-footer">
                    <button type="button" id="message-modal-close" class="btn btn-secondary" data-dismiss="modal">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script>
        // Initialize canvas
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");

        var startBtn = document.getElementById("start-btn");
        var pauseBtn = document.getElementById("pause-btn");
        var restartBtn = document.getElementById("restart-btn");
        var animationId;
        var gameRunning = false;

        startBtn.addEventListener("click", function() {
            if (!gameRunning) {
                // only start the game if gameRunning is false
                gameRunning = true; // set gameRunning to true when the game starts
                loop();
            }
        });

        pauseBtn.addEventListener("click", function() {
            gameRunning = false;
            cancelAnimationFrame(animationId);
        });

        restartBtn.addEventListener("click", function() {
            document.location.reload();
        });

        addEventListener("load", (event) => {
            draw();

            // Try to go fullscreen on page load
            document.documentElement.requestFullscreen().catch(err => {
                console.log("Couldn't automatically enter fullscreen: " + err.message);
            });
        });

        // Define ball properties
        var ballRadius = 10;
        var ballX = canvas.width / 2;
        var ballY = canvas.height / 2;
        var ballSpeedX = 5;
        var ballSpeedY = 5;

        // Define paddle properties
        var paddleHeight = 80;
        var paddleWidth = 10;
        var leftPaddleY = canvas.height / 2 - paddleHeight / 2;
        var rightPaddleY = canvas.height / 2 - paddleHeight / 2;
        var paddleSpeed = 10;

        // Define score properties
        var leftPlayerScore = 0;
        var rightPlayerScore = 0;
        var maxScore = 10;

        // Listen for keyboard events
        document.addEventListener("keydown", keyDownHandler);
        document.addEventListener("keyup", keyUpHandler);

        // Handle key press
        var upPressed = false;
        var downPressed = false;
        let wPressed = false;
        let sPressed = false;

        function keyDownHandler(e) {
            if (e.key === "ArrowUp") {
                upPressed = true;
            } else if (e.key === "ArrowDown") {
                downPressed = true;
            } else if (e.key === "w" || e.key === "W") {
                wPressed = true;
            } else if (e.key === "s" || e.key === "S") {
                sPressed = true;
            }
        }

        // Handle key release
        function keyUpHandler(e) {
            if (e.key === "ArrowUp") {
                upPressed = false;
            } else if (e.key === "ArrowDown") {
                downPressed = false;
            } else if (e.key === "w" || e.key === "W") {
                wPressed = false;
            } else if (e.key === "s" || e.key === "S") {
                sPressed = false;
            }
        }

        // Update game state
        function update() {
            // Move paddles
            if (upPressed && rightPaddleY > 0) {
                rightPaddleY -= paddleSpeed;
            } else if (downPressed && rightPaddleY + paddleHeight < canvas.height) {
                rightPaddleY += paddleSpeed;
            }

            // Move left paddle based on "w" and "s" keys
            if (wPressed && leftPaddleY > 0) {
                leftPaddleY -= paddleSpeed;
            } else if (sPressed && leftPaddleY + paddleHeight < canvas.height) {
                leftPaddleY += paddleSpeed;
            }

            // Move ball
            ballX += ballSpeedX;
            ballY += ballSpeedY;

            // Check if ball collides with top or bottom of canvas
            if (ballY - ballRadius < 0 || ballY + ballRadius > canvas.height) {
                ballSpeedY = -ballSpeedY;
            }

            // Check if ball collides with left paddle
            if (
                ballX - ballRadius < paddleWidth &&
                ballY > leftPaddleY &&
                ballY < leftPaddleY + paddleHeight
            ) {
                ballSpeedX = -ballSpeedX;
            }

            // Check if ball collides with right paddle
            if (
                ballX + ballRadius > canvas.width - paddleWidth &&
                ballY > rightPaddleY &&
                ballY < rightPaddleY + paddleHeight
            ) {
                ballSpeedX = -ballSpeedX;
            }

            // Check if ball goes out of bounds on left or right side of canvas
            if (ballX < 0) {
                rightPlayerScore++;
                reset();
            } else if (ballX > canvas.width) {
                leftPlayerScore++;
                reset();
            }

            // Check if a player has won
            if (leftPlayerScore === maxScore) {
                playerWin("Left player");
            } else if (rightPlayerScore === maxScore) {
                playerWin("Right player");
            }
        }

        function playerWin(player) {
            var message = "Congratulations! " + player + " wins!";
            $("#message").text(message); // Set the message text
            $("#message-modal").modal("show"); // Display the message modal
            gameRunning = false;
            cancelAnimationFrame(animationId);
        }

        // Reset ball to center of screen
        function reset() {
            ballX = canvas.width / 2;
            ballY = canvas.height / 2;
            ballSpeedX = -ballSpeedX;
            ballSpeedY = Math.random() * 10 - 5;
        }

        // Draw objects on canvas
        function draw() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = "#FFF";
            ctx.font = "15px Arial";

            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.strokeStyle = "#FFF"; // Set line color to white
            ctx.stroke();
            ctx.closePath();

            // Draw ball
            ctx.beginPath();
            ctx.arc(ballX, ballY, ballRadius, 0, Math.PI * 2);
            ctx.fill();
            ctx.closePath();

            // Draw left paddle
            ctx.fillRect(0, leftPaddleY, paddleWidth, paddleHeight);

            // Draw right paddle
            ctx.fillRect(
                canvas.width - paddleWidth,
                rightPaddleY,
                paddleWidth,
                paddleHeight
            );

            // Draw scores
            ctx.fillText("Score: " + leftPlayerScore, 10, 20);
            ctx.fillText("Score: " + rightPlayerScore, canvas.width - 70, 20);
        }

        // Game loop
        function loop() {
            update();
            draw();
            animationId = requestAnimationFrame(loop);
        }

        $("#message-modal-close").on("click", function() {
            document.location.reload();
        });
    </script>
</body>

</html>